{"ast":null,"code":"import axios from 'axios';\nimport { ElMessage, ElMessageBox } from 'element-plus';\nexport default {\n  name: 'SelectedDir',\n  methods: {\n    async selectDir() {\n      try {\n        const api = this.$store.state.api;\n        const response = await axios.post(`${api}/selectedDir`);\n        const dirname = response.data.data;\n        await this.showConfirmation(dirname);\n        if (dirname) {\n          this.$store.state.DirPath = await this.handleDirSelection(dirname, api);\n        }\n      } catch (error) {\n        ElMessage({\n          type: 'error',\n          message: '出错了: ' + error.message\n        });\n      }\n    },\n    async showConfirmation(dirname) {\n      return ElMessageBox.confirm(dirname, '警告', {\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n        type: 'warning'\n      });\n    },\n    async handleDirSelection(dirname, api) {\n      try {\n        const response = await axios.get(`${api}/SucceedselectedDir`, {\n          params: {\n            dirname\n          }\n        });\n        const dirPath = response.data.data;\n        this.$store.state.DirPath = dirPath;\n        console.log(\"选择的目录路径:\", dirPath);\n        const dirsFileList = await this.fetchDirsFileList(dirPath, api);\n        this.$store.state.DirsFileList = dirsFileList;\n        return dirPath;\n      } catch (error) {\n        ElMessage({\n          type: 'error',\n          message: '处理目录选择时出错: ' + error.message\n        });\n      }\n    },\n    async fetchDirsFileList(dirPath, api) {\n      try {\n        const response = await axios.post(`${api}/DirsFileList`, {\n          params: {\n            DirsFileList: dirPath\n          }\n        });\n        return this.processDirsFileList(response.data.data, api);\n      } catch (error) {\n        ElMessage({\n          type: 'error',\n          message: '获取目录文件列表时出错: ' + error.message\n        });\n      }\n    },\n    async processDirsFileList(dirsFileList, api) {\n      const updatedList = dirsFileList.map((item, index) => ({\n        index,\n        data: item,\n        FileType: false\n      }));\n      try {\n        const openDirResponse = await axios.post(`${api}/OpenDir`);\n        const folders = Object.values(openDirResponse.data.su);\n        updatedList.forEach(dir => {\n          if (folders.includes(dir.data)) {\n            dir.FileType = '文件夹';\n          }\n        });\n        const fileTypesResponse = await axios.get(`${api}/filesypess`, {\n          params: {\n            filesypessPath: this.$store.state.DirPath\n          }\n        });\n        const fileTypes = Object.values(fileTypesResponse.data.filesypessPathlistTypes);\n        fileTypes.forEach(type => {\n          updatedList[type.index].FileType = type.filesypessPathlistType;\n        });\n        return updatedList;\n      } catch (error) {\n        ElMessage({\n          type: 'error',\n          message: '处理文件类型时出错: ' + error.message\n        });\n      }\n    }\n  }\n};","map":{"version":3,"names":["axios","ElMessage","ElMessageBox","name","methods","selectDir","api","$store","state","response","post","dirname","data","showConfirmation","DirPath","handleDirSelection","error","type","message","confirm","confirmButtonText","cancelButtonText","get","params","dirPath","console","log","dirsFileList","fetchDirsFileList","DirsFileList","processDirsFileList","updatedList","map","item","index","FileType","openDirResponse","folders","Object","values","su","forEach","dir","includes","fileTypesResponse","filesypessPath","fileTypes","filesypessPathlistTypes","filesypessPathlistType"],"sources":["D:\\code\\lan\\LAN-Sharing\\restvue003\\src\\components\\selectedDir.vue"],"sourcesContent":["<template>\r\n    <div>\r\n        <el-button @click=\"selectDir\">选择根目录</el-button>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nimport { ElMessage, ElMessageBox } from 'element-plus';\r\n\r\nexport default {\r\n    name: 'SelectedDir',\r\n    methods: {\r\n        async selectDir() {\r\n            try {\r\n                const api = this.$store.state.api;\r\n                const response = await axios.post(`${api}/selectedDir`);\r\n                const dirname = response.data.data;\r\n\r\n                await this.showConfirmation(dirname);\r\n                if (dirname) {\r\n                    this.$store.state.DirPath = await this.handleDirSelection(dirname, api);\r\n                }\r\n            } catch (error) {\r\n                ElMessage({ type: 'error', message: '出错了: ' + error.message });\r\n            }\r\n        },\r\n\r\n        async showConfirmation(dirname) {\r\n            return ElMessageBox.confirm(dirname, '警告', {\r\n                confirmButtonText: '确定',\r\n                cancelButtonText: '取消',\r\n                type: 'warning',\r\n            });\r\n        },\r\n\r\n        async handleDirSelection(dirname, api) {\r\n            try {\r\n                const response = await axios.get(`${api}/SucceedselectedDir`, {\r\n                    params: { dirname }\r\n                });\r\n                const dirPath = response.data.data;\r\n                this.$store.state.DirPath = dirPath;\r\n                console.log(\"选择的目录路径:\", dirPath);\r\n                const dirsFileList = await this.fetchDirsFileList(dirPath, api);\r\n                this.$store.state.DirsFileList = dirsFileList;\r\n\r\n                return dirPath;\r\n            } catch (error) {\r\n                ElMessage({ type: 'error', message: '处理目录选择时出错: ' + error.message });\r\n            }\r\n        },\r\n\r\n        async fetchDirsFileList(dirPath, api) {\r\n            try {\r\n                const response = await axios.post(`${api}/DirsFileList`, {\r\n                    params: { DirsFileList: dirPath }\r\n                });\r\n                return this.processDirsFileList(response.data.data, api);\r\n            } catch (error) {\r\n                ElMessage({ type: 'error', message: '获取目录文件列表时出错: ' + error.message });\r\n            }\r\n        },\r\n\r\n        async processDirsFileList(dirsFileList, api) {\r\n            const updatedList = dirsFileList.map((item, index) => ({\r\n                index,\r\n                data: item,\r\n                FileType: false,\r\n            }));\r\n\r\n            try {\r\n                const openDirResponse = await axios.post(`${api}/OpenDir`);\r\n                const folders = Object.values(openDirResponse.data.su);\r\n\r\n                updatedList.forEach(dir => {\r\n                    if (folders.includes(dir.data)) {\r\n                        dir.FileType = '文件夹';\r\n                    }\r\n                });\r\n\r\n                const fileTypesResponse = await axios.get(`${api}/filesypess`, {\r\n                    params: { filesypessPath: this.$store.state.DirPath }\r\n                });\r\n\r\n                const fileTypes = Object.values(fileTypesResponse.data.filesypessPathlistTypes);\r\n                fileTypes.forEach(type => {\r\n                    updatedList[type.index].FileType = type.filesypessPathlistType;\r\n                });\r\n\r\n                return updatedList;\r\n            } catch (error) {\r\n                ElMessage({ type: 'error', message: '处理文件类型时出错: ' + error.message });\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n"],"mappings":"AAOA,OAAOA,KAAI,MAAO,OAAO;AACzB,SAASC,SAAS,EAAEC,YAAW,QAAS,cAAc;AAEtD,eAAe;EACXC,IAAI,EAAE,aAAa;EACnBC,OAAO,EAAE;IACL,MAAMC,SAASA,CAAA,EAAG;MACd,IAAI;QACA,MAAMC,GAAE,GAAI,IAAI,CAACC,MAAM,CAACC,KAAK,CAACF,GAAG;QACjC,MAAMG,QAAO,GAAI,MAAMT,KAAK,CAACU,IAAI,CAAE,GAAEJ,GAAI,cAAa,CAAC;QACvD,MAAMK,OAAM,GAAIF,QAAQ,CAACG,IAAI,CAACA,IAAI;QAElC,MAAM,IAAI,CAACC,gBAAgB,CAACF,OAAO,CAAC;QACpC,IAAIA,OAAO,EAAE;UACT,IAAI,CAACJ,MAAM,CAACC,KAAK,CAACM,OAAM,GAAI,MAAM,IAAI,CAACC,kBAAkB,CAACJ,OAAO,EAAEL,GAAG,CAAC;QAC3E;MACJ,EAAE,OAAOU,KAAK,EAAE;QACZf,SAAS,CAAC;UAAEgB,IAAI,EAAE,OAAO;UAAEC,OAAO,EAAE,OAAM,GAAIF,KAAK,CAACE;QAAQ,CAAC,CAAC;MAClE;IACJ,CAAC;IAED,MAAML,gBAAgBA,CAACF,OAAO,EAAE;MAC5B,OAAOT,YAAY,CAACiB,OAAO,CAACR,OAAO,EAAE,IAAI,EAAE;QACvCS,iBAAiB,EAAE,IAAI;QACvBC,gBAAgB,EAAE,IAAI;QACtBJ,IAAI,EAAE;MACV,CAAC,CAAC;IACN,CAAC;IAED,MAAMF,kBAAkBA,CAACJ,OAAO,EAAEL,GAAG,EAAE;MACnC,IAAI;QACA,MAAMG,QAAO,GAAI,MAAMT,KAAK,CAACsB,GAAG,CAAE,GAAEhB,GAAI,qBAAoB,EAAE;UAC1DiB,MAAM,EAAE;YAAEZ;UAAQ;QACtB,CAAC,CAAC;QACF,MAAMa,OAAM,GAAIf,QAAQ,CAACG,IAAI,CAACA,IAAI;QAClC,IAAI,CAACL,MAAM,CAACC,KAAK,CAACM,OAAM,GAAIU,OAAO;QACnCC,OAAO,CAACC,GAAG,CAAC,UAAU,EAAEF,OAAO,CAAC;QAChC,MAAMG,YAAW,GAAI,MAAM,IAAI,CAACC,iBAAiB,CAACJ,OAAO,EAAElB,GAAG,CAAC;QAC/D,IAAI,CAACC,MAAM,CAACC,KAAK,CAACqB,YAAW,GAAIF,YAAY;QAE7C,OAAOH,OAAO;MAClB,EAAE,OAAOR,KAAK,EAAE;QACZf,SAAS,CAAC;UAAEgB,IAAI,EAAE,OAAO;UAAEC,OAAO,EAAE,aAAY,GAAIF,KAAK,CAACE;QAAQ,CAAC,CAAC;MACxE;IACJ,CAAC;IAED,MAAMU,iBAAiBA,CAACJ,OAAO,EAAElB,GAAG,EAAE;MAClC,IAAI;QACA,MAAMG,QAAO,GAAI,MAAMT,KAAK,CAACU,IAAI,CAAE,GAAEJ,GAAI,eAAc,EAAE;UACrDiB,MAAM,EAAE;YAAEM,YAAY,EAAEL;UAAQ;QACpC,CAAC,CAAC;QACF,OAAO,IAAI,CAACM,mBAAmB,CAACrB,QAAQ,CAACG,IAAI,CAACA,IAAI,EAAEN,GAAG,CAAC;MAC5D,EAAE,OAAOU,KAAK,EAAE;QACZf,SAAS,CAAC;UAAEgB,IAAI,EAAE,OAAO;UAAEC,OAAO,EAAE,eAAc,GAAIF,KAAK,CAACE;QAAQ,CAAC,CAAC;MAC1E;IACJ,CAAC;IAED,MAAMY,mBAAmBA,CAACH,YAAY,EAAErB,GAAG,EAAE;MACzC,MAAMyB,WAAU,GAAIJ,YAAY,CAACK,GAAG,CAAC,CAACC,IAAI,EAAEC,KAAK,MAAM;QACnDA,KAAK;QACLtB,IAAI,EAAEqB,IAAI;QACVE,QAAQ,EAAE;MACd,CAAC,CAAC,CAAC;MAEH,IAAI;QACA,MAAMC,eAAc,GAAI,MAAMpC,KAAK,CAACU,IAAI,CAAE,GAAEJ,GAAI,UAAS,CAAC;QAC1D,MAAM+B,OAAM,GAAIC,MAAM,CAACC,MAAM,CAACH,eAAe,CAACxB,IAAI,CAAC4B,EAAE,CAAC;QAEtDT,WAAW,CAACU,OAAO,CAACC,GAAE,IAAK;UACvB,IAAIL,OAAO,CAACM,QAAQ,CAACD,GAAG,CAAC9B,IAAI,CAAC,EAAE;YAC5B8B,GAAG,CAACP,QAAO,GAAI,KAAK;UACxB;QACJ,CAAC,CAAC;QAEF,MAAMS,iBAAgB,GAAI,MAAM5C,KAAK,CAACsB,GAAG,CAAE,GAAEhB,GAAI,aAAY,EAAE;UAC3DiB,MAAM,EAAE;YAAEsB,cAAc,EAAE,IAAI,CAACtC,MAAM,CAACC,KAAK,CAACM;UAAQ;QACxD,CAAC,CAAC;QAEF,MAAMgC,SAAQ,GAAIR,MAAM,CAACC,MAAM,CAACK,iBAAiB,CAAChC,IAAI,CAACmC,uBAAuB,CAAC;QAC/ED,SAAS,CAACL,OAAO,CAACxB,IAAG,IAAK;UACtBc,WAAW,CAACd,IAAI,CAACiB,KAAK,CAAC,CAACC,QAAO,GAAIlB,IAAI,CAAC+B,sBAAsB;QAClE,CAAC,CAAC;QAEF,OAAOjB,WAAW;MACtB,EAAE,OAAOf,KAAK,EAAE;QACZf,SAAS,CAAC;UAAEgB,IAAI,EAAE,OAAO;UAAEC,OAAO,EAAE,aAAY,GAAIF,KAAK,CAACE;QAAQ,CAAC,CAAC;MACxE;IACJ;EACJ;AACJ"},"metadata":{},"sourceType":"module","externalDependencies":[]}